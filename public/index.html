<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Bot Control</title>
<style>
body {
  margin:0;
  background:#000;
  font-family:-apple-system;
  color:white;
}

.glass {
  background:rgba(255,255,255,0.07);
  backdrop-filter:blur(25px);
  border-radius:25px;
  padding:15px;
  margin:15px;
  box-shadow:0 10px 30px rgba(255,255,255,0.08);
}

.container {
  display:flex;
  height:80vh;
}

.sidebar {
  width:35%;
  overflow:auto;
}

.chat {
  flex:1;
  display:flex;
  flex-direction:column;
}

.messages {
  flex:1;
  overflow:auto;
}

input {
  width:70%;
  padding:10px;
  border-radius:15px;
  border:none;
  background:#111;
  color:white;
}

button {
  padding:10px;
  border-radius:15px;
  border:none;
  background:white;
  color:black;
  font-weight:bold;
}
</style>
</head>
<body>

<div class="glass" id="info"></div>

<div class="container">
  <div class="sidebar glass" id="chatList"></div>
  <div class="chat glass">
    <div class="messages" id="messages"></div>
    <div>
      <input id="msg" placeholder="Message">
      <button onclick="send()">Send</button>
    </div>
  </div>
</div>

<script>
let chats = {};
let currentChat = null;

async function load() {
  const res = await fetch("/api/data");
  const data = await res.json();

  document.getElementById("info").innerHTML = `
    <h2>${data.bot.username}</h2>
    <p>ID: ${data.bot.id}</p>
    <p>Visits: ${data.visits}</p>
    <p>Status: ðŸŸ¢ ONLINE</p>
  `;

  chats = data.chats;
  renderChats();
  if(currentChat) renderMessages();
}

function renderChats() {
  const list = document.getElementById("chatList");
  list.innerHTML = "";
  Object.values(chats).forEach(c=>{
    const div = document.createElement("div");
    div.innerHTML = c.title;
    div.style.padding="10px";
    div.onclick=()=>{currentChat=c.id;renderMessages();}
    list.appendChild(div);
  });
}

function renderMessages(){
  const box=document.getElementById("messages");
  box.innerHTML="";
  chats[currentChat].messages.forEach(m=>{
    box.innerHTML+=`<p><b>${m.from}:</b> ${m.text}</p>`;
  });
}

async function send(){
  const text=document.getElementById("msg").value;
  await fetch("/api/send",{
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({chatId:currentChat,text})
  });
  document.getElementById("msg").value="";
  load();
}

setInterval(load,2000);
load();
</script>

</body>
</html>
